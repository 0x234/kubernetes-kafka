# Sets up a pod that monitors itself, to test resource usage etc.
# kubectl exec monitoring-test-... -- /bin/sh -c 'apk add --no-cache curl && curl http://localhost:5556/metrics'
apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  name: monitoring-test
  namespace: kafka
spec:
  replicas: 1
  template:
    metadata:
      labels:
        app: monitoring-test
      # Uncomment to test with prometheus
      #annotations:
      #  prometheus.io/scrape: "true"
      #  prometheus.io/port: "5556"
    spec:
      containers:
      - name: monitor
        image: solsson/kafka-prometheus-jmx-exporter@sha256:1f7c96c287a2dbec1d909cd8f96c0656310239b55a9a90d7fd12c81f384f1f7d
        command:
        - java
        - -Dcom.sun.management.jmxremote.ssl=false
        - -Dcom.sun.management.jmxremote.authenticate=false
        - -Dcom.sun.management.jmxremote.port=5555
        - -jar
        - jmx_prometheus_httpserver.jar
        - "5556"
        - example_configs/httpserver_sample_config.yml
        ports:
        - name: jmx
          containerPort: 5555
        - name: slashmetrics
          containerPort: 5556
